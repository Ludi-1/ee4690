import cocotb
from cocotb.clock import Clock
from cocotb.triggers import RisingEdge, FallingEdge, Timer
from cocotb.binary import BinaryValue
import random

SAMPLE = "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011100000000000000000000000011111111111111100000000000000000111111111111000000000000000000000000011000000000000000000000000001100000000000000000000000001100000000000000000000000001110000000000000000000000000110000000000000000000000000111000000000000000000000000011000000000000000000000000001100000000000000000000000001100000000000000000000000001110000000000000000000000001110000000000000000000000000110000000000000000000000000110000000000000000000000000111000000000000000000000000011100000000000000000000000001110000000000000000000000000110000000000000000000000000000000000000000000"
GOLDEN = [26, -42, -4, 52, -8, 10, -46, 82, -18, 34]

@cocotb.test()
async def toplevel_test(dut):
    clock = Clock(dut.clk, 10, units="ns")  # Create a 10ns clock period
    cocotb.start_soon(clock.start())  # Start the clock
    dut.reset.value = 1
    dut.start.value = 0
    await RisingEdge(dut.clk)
    dut.reset.value = 0
    dut.w_e.value = 1
    for bit in SAMPLE[::-1]:
        dut.data.value = int(bit)
        await RisingEdge(dut.clk)
    dut.w_e.value = 0
    dut.start.value = 1
    await RisingEdge(dut.clk)
    dut.start.value = 0
    await RisingEdge(dut.clk)
    await RisingEdge(dut.clk)
    while dut.ready.value != 1:
    # for i in range(100):
        await RisingEdge(dut.clk)
    assert([x.signed_integer for x in dut.preds.value] == GOLDEN)